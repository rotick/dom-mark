!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).DomMark=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var n=[],i=[],o=function(){function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"body",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e(this,o),this.container=null,this.box=null,this.observer=null,this.options={},t instanceof window.HTMLElement?this.container=t:this.container=document.querySelector(t),!this.container)throw new Error("invalid selector: ".concat(t));var i=this.container.querySelector('div[powered-by="https://github.com/rotick/dom-mark"]');i&&(this.box=i),this._setOptions(n)}var r,a,s;return r=o,(a=[{key:"render",value:function(){var e=this,t=n.indexOf(this.container);t>-1&&(this.observer=i[t],n.splice(t,1),i.splice(t,1)),this.observer&&this.observer.disconnect();var o=this.options,r=o.content,a=o.fontSize,s=o.fontFamily,c=o.opacity,d=o.color,h=o.padding,u=o.zIndex,l=o.minMargin,p=o.rotate,b=o.observe;"static"===window.getComputedStyle(this.container).position&&(this.container.style.position="relative");var f=this.box||document.createElement("div");this.box=f;var v=document.createElement("div");f.style.cssText="position:absolute;top:0;left:0;right:0;bottom:0;font-size:".concat(a,";\n    font-family:").concat(s,";opacity:").concat(c,";color:").concat(d,";pointer-events:none;\n    user-select: none;-ms-user-select: none;z-index:").concat(u,";z-index:-1\\9;"),f.setAttribute("powered-by","https://github.com/rotick/dom-mark"),f.setAttribute("onselectstart","return false;"),f.setAttribute("ondragstart","return false;"),v.style.cssText="position:absolute;top:0;left:0;opacity:0;",v.innerHTML=r,f.appendChild(v),this.container.appendChild(f);var m=function(){var t=window.getComputedStyle(f),n=Number(t.width.replace("px","")),i=Number(t.height.replace("px","")),o=window.getComputedStyle(v),a=Number(o.width.replace("px","")),s=Number(o.height.replace("px",""));v=null;var c=e._arrange({boxWidth:n,boxHeight:i,itemWidth:a,itemHeight:s,boxPadding:h,minMarginH:l[1],minMarginV:l[0]}).map((function(e){return'<div style="position:absolute;top:'.concat(e.y,"px;left:").concat(e.x,"px;transform:rotate(").concat(p,'deg);">').concat(r,"</div>")}));f.innerHTML=c.join(""),b&&e._observe()},g=f.querySelectorAll("img");g.length?function(){for(var e=[],t=function(t){var n=g[t];n.onload=function(){e.push(1),e.length===g.length&&m()},n.onerror=function(){throw new Error("image load error: ".concat(n.src))}},n=0;n<g.length;n++)t(n)}():m()}},{key:"update",value:function(e){this.observer&&this.observer.disconnect(),this._setOptions(e),this.render()}},{key:"destroy",value:function(){this.observer&&this.observer.disconnect(),this.box&&this.box.remove()}},{key:"_setOptions",value:function(e){if(e.padding&&"number"!=typeof e.padding)throw new TypeError("padding must be a number");if(e.minMargin&&(!Array.isArray(e.minMargin)||e.minMargin.length<2||"number"!=typeof e.minMargin[0]||"number"!=typeof e.minMargin[1]))throw new TypeError("minMargin must be an array with 2 number item");this.options=Object.assign({content:"",fontSize:"inherit",fontFamily:"inherit",color:"inherit",opacity:.3,padding:20,zIndex:6e3,minMargin:[40,20],rotate:-15,observe:!0},this.options,e)}},{key:"_arrange",value:function(e){for(var t=e.boxWidth,n=void 0===t?800:t,i=e.boxHeight,o=void 0===i?600:i,r=e.boxPadding,a=void 0===r?10:r,s=e.itemWidth,c=void 0===s?90:s,d=e.itemHeight,h=void 0===d?30:d,u=e.minMarginH,l=void 0===u?10:u,p=e.minMarginV,b=void 0===p?10:p,f=Math.floor((n-2*a)/(c+l)),v=Math.floor((o-2*a)/(h+b)),m=(n-2*a-c*f)/(f-1),g=(o-2*a-h*v)/(v-1),y=f*v,x=[],w=1;w<=y;w++){var M=a+(w%f==0?f-1:w%f-1)*(c+m),k=a+(Math.ceil(w/f)-1)*(h+g);x.push({x:M,y:k})}return x}},{key:"_observe",value:function(){var e=this;window.MutationObserver&&(this.observer=new window.MutationObserver((function(t){for(var n=0;n<t.length;n++){var i=t[n],o=i.target;if(i.removedNodes.length&&(o=i.removedNodes[0]),e._getParents(o).indexOf(e.box)>-1){e.render();break}}})),this.observer.observe(this.container,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),n.push(this.container),i.push(this.observer))}},{key:"_getParents",value:function(e){var t=[e];return function e(n){return n.parentNode?(t.push(n.parentNode),e(n.parentNode)):t}(e)}}])&&t(r.prototype,a),s&&t(r,s),Object.defineProperty(r,"prototype",{writable:!1}),o}();return o}));
